(function(){"use strict";var cn=function(n){_n(n);var t=On(n);return n.on=t.on,n.off=t.off,n.fire=t.fire,n};function On(n){var t=Object.create(null);return{on:function(e,i,h){if(typeof i!="function")throw new Error("callback is expected to be a function");var a=t[e];return a||(a=t[e]=[]),a.push({callback:i,ctx:h}),n},off:function(e,i){var h=typeof e=="undefined";if(h)return t=Object.create(null),n;if(t[e]){var a=typeof i!="function";if(a)delete t[e];else for(var p=t[e],f=0;f<p.length;++f)p[f].callback===i&&p.splice(f,1)}return n},fire:function(e){var i=t[e];if(!i)return n;var h;arguments.length>1&&(h=Array.prototype.splice.call(arguments,1));for(var a=0;a<i.length;++a){var p=i[a];p.callback.apply(p.ctx,h)}return n}}}function _n(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");for(var t=["on","fire","off"],e=0;e<t.length;++e)if(n.hasOwnProperty(t[e]))throw new Error("Subject cannot be eventified, since it already has property '"+t[e]+"'")}var Mn=qn,Cn=cn;function qn(n){n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1);var t=typeof Object.create=="function"?Object.create(null):{},e=[],i={},h=0,a=0,p=sn(),f=n.multigraph?O:I,v=[],k=R,l=R,s=R,u=R,g={addNode:w,addLink:_,removeLink:M,removeNode:E,getNode:d,getNodesCount:function(){return h},getLinksCount:function(){return e.length},getLinks:C,forEachNode:p,forEachLinkedNode:F,forEachLink:b,beginUpdate:s,endUpdate:u,clear:D,hasLink:q,hasNode:d,getLink:q};return Cn(g),m(),g;function m(){var r=g.on;g.on=o;function o(){return g.beginUpdate=s=V,g.endUpdate=u=X,k=P,l=x,g.on=r,r.apply(g,arguments)}}function P(r,o){v.push({link:r,changeType:o})}function x(r,o){v.push({node:r,changeType:o})}function w(r,o){if(r===void 0)throw new Error("Invalid node identifier");s();var c=d(r);return c?(c.data=o,l(c,"update")):(c=new Sn(r,o),h++,l(c,"add")),t[r]=c,u(),c}function d(r){return t[r]}function E(r){var o=d(r);if(!o)return!1;s();var c=o.links;if(c){o.links=null;for(var y=0;y<c.length;++y)M(c[y])}return delete t[r],h--,l(o,"remove"),u(),!0}function _(r,o,c){s();var y=d(r)||w(r),N=d(o)||w(o),L=f(r,o,c);return e.push(L),ln(y,L),r!==o&&ln(N,L),k(L,"add"),u(),L}function I(r,o,c){var y=z(r,o);return new dn(r,o,c,y)}function O(r,o,c){var y=z(r,o),N=i.hasOwnProperty(y);if(N||q(r,o)){N||(i[y]=0);var L="@"+ ++i[y];y=z(r+L,o+L)}return new dn(r,o,c,y)}function C(r){var o=d(r);return o?o.links:null}function M(r){if(!r)return!1;var o=W(r,e);if(o<0)return!1;s(),e.splice(o,1);var c=d(r.fromId),y=d(r.toId);return c&&(o=W(r,c.links),o>=0&&c.links.splice(o,1)),y&&(o=W(r,y.links),o>=0&&y.links.splice(o,1)),k(r,"remove"),u(),!0}function q(r,o){var c=d(r),y;if(!c||!c.links)return null;for(y=0;y<c.links.length;++y){var N=c.links[y];if(N.fromId===r&&N.toId===o)return N}return null}function D(){s(),p(function(r){E(r.id)}),u()}function b(r){var o,c;if(typeof r=="function")for(o=0,c=e.length;o<c;++o)r(e[o])}function F(r,o,c){var y=d(r);if(y&&y.links&&typeof o=="function")return c?$(y.links,r,o):U(y.links,r,o)}function U(r,o,c){for(var y,N=0;N<r.length;++N){var L=r[N],fn=L.fromId===o?L.toId:L.fromId;if(y=c(t[fn],L),y)return!0}}function $(r,o,c){for(var y,N=0;N<r.length;++N){var L=r[N];if(L.fromId===o&&(y=c(t[L.toId],L),y))return!0}}function R(){}function V(){a+=1}function X(){a-=1,a===0&&v.length>0&&(g.fire("changed",v),v.length=0)}function sn(){return Object.keys?an:un}function an(r){if(typeof r=="function"){for(var o=Object.keys(t),c=0;c<o.length;++c)if(r(t[o[c]]))return!0}}function un(r){if(typeof r=="function"){var o;for(o in t)if(r(t[o]))return!0}}}function W(n,t){if(!t)return-1;if(t.indexOf)return t.indexOf(n);var e=t.length,i;for(i=0;i<e;i+=1)if(t[i]===n)return i;return-1}function Sn(n,t){this.id=n,this.links=null,this.data=t}function ln(n,t){n.links?n.links.push(t):n.links=[t]}function dn(n,t,e,i){this.fromId=n,this.toId=t,this.data=e,this.id=i}function z(n,t){return n.toString()+"\u{1F449} "+t.toString()}var Tn=bn,Dn=cn;function bn(n){n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now own each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1);var t=typeof Object.create=="function"?Object.create(null):{},e=[],i={},h=0,a=0,p=sn(),f=n.multigraph?O:I,v=[],k=R,l=R,s=R,u=R,g={addNode:w,addLink:_,removeLink:M,removeNode:E,getNode:d,getNodesCount:function(){return h},getLinksCount:function(){return e.length},getLinks:C,forEachNode:p,forEachLinkedNode:F,forEachLink:b,beginUpdate:s,endUpdate:u,clear:D,hasLink:q,hasNode:d,getLink:q};return Dn(g),m(),g;function m(){var r=g.on;g.on=o;function o(){return g.beginUpdate=s=V,g.endUpdate=u=X,k=P,l=x,g.on=r,r.apply(g,arguments)}}function P(r,o){v.push({link:r,changeType:o})}function x(r,o){v.push({node:r,changeType:o})}function w(r,o){if(r===void 0)throw new Error("Invalid node identifier");s();var c=d(r);return c?(c.data=o,l(c,"update")):(c=new Fn(r,o),h++,l(c,"add")),t[r]=c,u(),c}function d(r){return t[r]}function E(r){var o=d(r);if(!o)return!1;s();var c=o.links;if(c){o.links=null;for(var y=0;y<c.length;++y)M(c[y])}return delete t[r],h--,l(o,"remove"),u(),!0}function _(r,o,c){s();var y=d(r)||w(r),N=d(o)||w(o),L=f(r,o,c);return e.push(L),hn(y,L),r!==o&&hn(N,L),k(L,"add"),u(),L}function I(r,o,c){var y=nn(r,o);return new gn(r,o,c,y)}function O(r,o,c){var y=nn(r,o),N=i.hasOwnProperty(y);if(N||q(r,o)){N||(i[y]=0);var L="@"+ ++i[y];y=nn(r+L,o+L)}return new gn(r,o,c,y)}function C(r){var o=d(r);return o?o.links:null}function M(r){if(!r)return!1;var o=Z(r,e);if(o<0)return!1;s(),e.splice(o,1);var c=d(r.fromId),y=d(r.toId);return c&&(o=Z(r,c.links),o>=0&&c.links.splice(o,1)),y&&(o=Z(r,y.links),o>=0&&y.links.splice(o,1)),k(r,"remove"),u(),!0}function q(r,o){var c=d(r),y;if(!c||!c.links)return null;for(y=0;y<c.links.length;++y){var N=c.links[y];if(N.fromId===r&&N.toId===o)return N}return null}function D(){s(),p(function(r){E(r.id)}),u()}function b(r){var o,c;if(typeof r=="function")for(o=0,c=e.length;o<c;++o)r(e[o])}function F(r,o,c){var y=d(r);if(y&&y.links&&typeof o=="function")return c?$(y.links,r,o):U(y.links,r,o)}function U(r,o,c){for(var y,N=0;N<r.length;++N){var L=r[N],fn=L.fromId===o?L.toId:L.fromId;if(y=c(t[fn],L),y)return!0}}function $(r,o,c){for(var y,N=0;N<r.length;++N){var L=r[N];if(L.fromId===o&&(y=c(t[L.toId],L),y))return!0}}function R(){}function V(){a+=1}function X(){a-=1,a===0&&v.length>0&&(g.fire("changed",v),v.length=0)}function sn(){return Object.keys?an:un}function an(r){if(typeof r=="function"){for(var o=Object.keys(t),c=0;c<o.length;++c)if(r(t[o[c]]))return!0}}function un(r){if(typeof r=="function"){var o;for(o in t)if(r(t[o]))return!0}}}function Z(n,t){if(!t)return-1;if(t.indexOf)return t.indexOf(n);var e=t.length,i;for(i=0;i<e;i+=1)if(t[i]===n)return i;return-1}function Fn(n,t){this.id=n,this.links=null,this.data=t}function hn(n,t){n.links?n.links.push(t):n.links=[t]}function gn(n,t,e,i){this.fromId=n,this.toId=t,this.data=e,this.id=i}function nn(n,t){return n.toString()+"\u{1F449} "+t.toString()}var Un=Rn,An=Tn;function Rn(n,t,e){var i;t=t||pn,e=e||pn,typeof n=="string"?i=JSON.parse(n):i=n;var h=An(),a;if(i.links===void 0||i.nodes===void 0)throw new Error("Cannot load graph without links and nodes");for(a=0;a<i.nodes.length;++a){var p=t(i.nodes[a]);if(!p.hasOwnProperty("id"))throw new Error("Graph node format is invalid: Node id is missing");h.addNode(p.id,p.data)}for(a=0;a<i.links.length;++a){var f=e(i.links[a]);if(!f.hasOwnProperty("fromId")||!f.hasOwnProperty("toId"))throw new Error("Graph link format is invalid. Both fromId and toId are required");h.addLink(f.fromId,f.toId,f.data)}return h}function pn(n){return n}var jn=Kn;function Kn(n,t,e){var i={nodes:[],links:[]},h=t||v,a=e||k;return n.forEachNode(p),n.forEachLink(f),JSON.stringify(i);function p(l){i.nodes.push(h(l))}function f(l){i.links.push(a(l))}function v(l){var s={id:l.id};return l.data!==void 0&&(s.data=l.data),s}function k(l){var s={fromId:l.fromId,toId:l.toId};return l.data!==void 0&&(s.data=l.data),s}}class $n{constructor(){this.keys=[]}findKeyPosition(t,e){let i=0,h=this.keys.length;for(;i<h;){const a=Math.floor((i+h)/2);t.isLessThanOtherEdgeKey(this.keys[a])?h=a:i=a+1}return i}addKey(t,e){const i=this.findKeyPosition(t);this.keys.splice(i,0,t)}}let vn=0;class A{constructor(t,e){this.x=t[0],this.y=t[1],this.nodeId=vn,this.polygonID=e,this.edges=[],this.prevPoint=null,this.nextPoint=null,vn++}isPointEqual(t){return t===null?!1:this.x===t.x&&this.y===t.y}angleToPoint(t){if(this.isPointEqual(t))return 0;const e=t.x-this.x,i=t.y-this.y;return e===0?i<0?Hn:Wn:i===0?e<0?Math.PI:0:e<0?Math.PI+Math.atan(i/e):i<0?2*Math.PI+Math.atan(i/e):Math.atan(i/e)}}const j=11102230246251565e-32,S=134217729,Bn=(3+8*j)*j;function tn(n,t,e,i,h){let a,p,f,v,k=t[0],l=i[0],s=0,u=0;l>k==l>-k?(a=k,k=t[++s]):(a=l,l=i[++u]);let g=0;if(s<n&&u<e)for(l>k==l>-k?(p=k+a,f=a-(p-k),k=t[++s]):(p=l+a,f=a-(p-l),l=i[++u]),a=p,f!==0&&(h[g++]=f);s<n&&u<e;)l>k==l>-k?(p=a+k,v=p-a,f=a-(p-v)+(k-v),k=t[++s]):(p=a+l,v=p-a,f=a-(p-v)+(l-v),l=i[++u]),a=p,f!==0&&(h[g++]=f);for(;s<n;)p=a+k,v=p-a,f=a-(p-v)+(k-v),k=t[++s],a=p,f!==0&&(h[g++]=f);for(;u<e;)p=a+l,v=p-a,f=a-(p-v)+(l-v),l=i[++u],a=p,f!==0&&(h[g++]=f);return(a!==0||g===0)&&(h[g++]=a),g}function Jn(n,t){let e=t[0];for(let i=1;i<n;i++)e+=t[i];return e}function G(n){return new Float64Array(n)}const Gn=(3+16*j)*j,Qn=(2+12*j)*j,Vn=(9+64*j)*j*j,J=G(4),yn=G(8),kn=G(12),wn=G(16),T=G(4);function Xn(n,t,e,i,h,a,p){let f,v,k,l,s,u,g,m,P,x,w,d,E,_,I,O,C,M;const q=n-h,D=e-h,b=t-a,F=i-a;_=q*F,u=S*q,g=u-(u-q),m=q-g,u=S*F,P=u-(u-F),x=F-P,I=m*x-(_-g*P-m*P-g*x),O=b*D,u=S*b,g=u-(u-b),m=b-g,u=S*D,P=u-(u-D),x=D-P,C=m*x-(O-g*P-m*P-g*x),w=I-C,s=I-w,J[0]=I-(w+s)+(s-C),d=_+w,s=d-_,E=_-(d-s)+(w-s),w=E-O,s=E-w,J[1]=E-(w+s)+(s-O),M=d+w,s=M-d,J[2]=d-(M-s)+(w-s),J[3]=M;let U=Jn(4,J),$=Qn*p;if(U>=$||-U>=$||(s=n-q,f=n-(q+s)+(s-h),s=e-D,k=e-(D+s)+(s-h),s=t-b,v=t-(b+s)+(s-a),s=i-F,l=i-(F+s)+(s-a),f===0&&v===0&&k===0&&l===0)||($=Vn*p+Bn*Math.abs(U),U+=q*l+F*f-(b*k+D*v),U>=$||-U>=$))return U;_=f*F,u=S*f,g=u-(u-f),m=f-g,u=S*F,P=u-(u-F),x=F-P,I=m*x-(_-g*P-m*P-g*x),O=v*D,u=S*v,g=u-(u-v),m=v-g,u=S*D,P=u-(u-D),x=D-P,C=m*x-(O-g*P-m*P-g*x),w=I-C,s=I-w,T[0]=I-(w+s)+(s-C),d=_+w,s=d-_,E=_-(d-s)+(w-s),w=E-O,s=E-w,T[1]=E-(w+s)+(s-O),M=d+w,s=M-d,T[2]=d-(M-s)+(w-s),T[3]=M;const R=tn(4,J,4,T,yn);_=q*l,u=S*q,g=u-(u-q),m=q-g,u=S*l,P=u-(u-l),x=l-P,I=m*x-(_-g*P-m*P-g*x),O=b*k,u=S*b,g=u-(u-b),m=b-g,u=S*k,P=u-(u-k),x=k-P,C=m*x-(O-g*P-m*P-g*x),w=I-C,s=I-w,T[0]=I-(w+s)+(s-C),d=_+w,s=d-_,E=_-(d-s)+(w-s),w=E-O,s=E-w,T[1]=E-(w+s)+(s-O),M=d+w,s=M-d,T[2]=d-(M-s)+(w-s),T[3]=M;const V=tn(R,yn,4,T,kn);_=f*l,u=S*f,g=u-(u-f),m=f-g,u=S*l,P=u-(u-l),x=l-P,I=m*x-(_-g*P-m*P-g*x),O=v*k,u=S*v,g=u-(u-v),m=v-g,u=S*k,P=u-(u-k),x=k-P,C=m*x-(O-g*P-m*P-g*x),w=I-C,s=I-w,T[0]=I-(w+s)+(s-C),d=_+w,s=d-_,E=_-(d-s)+(w-s),w=E-O,s=E-w,T[1]=E-(w+s)+(s-O),M=d+w,s=M-d,T[2]=d-(M-s)+(w-s),T[3]=M;const X=tn(V,kn,4,T,wn);return wn[X-1]}function Yn(n,t,e,i,h,a){const p=(t-a)*(e-h),f=(n-h)*(i-a),v=p-f;if(p===0||f===0||p>0!=f>0)return v;const k=Math.abs(p+f);return Math.abs(v)>=Gn*k?v:-Xn(n,t,e,i,h,a,k)}const Hn=Math.PI*3/2,Wn=Math.PI/2;function Q(n,t,e){const i=e.p1,h=e.p2,a=K(n,t,i),p=K(n,t,h),f=K(i,h,n),v=K(i,h,t);return!!(a!==p&&f!==v||a===0&&(B(n,i,t)||B(n,h,t)||B(i,n,h)||B(i,t,h)))}function K(n,t,e){const i=Yn(e.x,e.y,t.x,t.y,n.x,n.y);return i>0?1:i<0?-1:0}function B(n,t,e){return t.x<=Math.max(n.x,e.x)&&t.x>=Math.min(n.x,e.x)&&t.y<=Math.max(n.y,e.y)&&t.y>=Math.min(n.y,e.y)}const Pn=10,zn=Math.pow(10,Pn),Zn=Math.pow(10,Pn);function xn(n,t,e){const i=Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),h=Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2),a=Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2),p=(i+a-h)/(2*Math.sqrt(i)*Math.sqrt(a));return Math.acos(parseInt(p*zn)/Zn)}function Ln(n,t,e){const i=nt(n,t,e);return i!==null?en(n,i):0}function nt(n,t,e){if(e.containsPoint(n))return n;if(e.containsPoint(t))return t;if(e.p1.x===e.p2.x){if(n.x===t.x)return null;const f=(n.y-t.y)/(n.x-t.x),v=e.p1.x,k=f*(v-n.x)+n.y;return new A([v,k],-1)}if(n.x===t.x){const f=(e.p1.y-e.p2.y)/(e.p1.x-e.p2.x),v=n.x,k=f*(v-e.p1.x)+e.p1.y;return new A([v,k],-1)}const i=(n.y-t.y)/(n.x-t.x),h=(e.p1.y-e.p2.y)/(e.p1.x-e.p2.x);if(i===h)return null;const a=(h*e.p1.x-i*n.x+n.y-e.p1.y)/(h-i),p=h*(a-e.p1.x)+e.p1.y;return new A([a,p],-1)}function en(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}class rn{constructor(t,e,i){this.p1=t,this.p2=e,this.edge=i}isLessThanOtherEdgeKey(t){if(this.matchesOtherKey(t))return!1;if(!Q(this.p1,this.p2,t.edge))return!0;const e=Ln(this.p1,this.p2,this.edge),i=Ln(this.p1,this.p2,t.edge);if(e>i)return!1;if(e<i)return!0;if(e===i){let h=null;t.edge.containsPoint(this.edge.p1)?h=this.edge.p1:h=this.edge.p2;const a=xn(this.p1,this.p2,this.edge.getOtherPointInEdge(h)),p=xn(this.p1,this.p2,t.edge.getOtherPointInEdge(h));return a<p}}matchesOtherKey(t){return this.edge.areEdgesEqual(t.edge)}}const tt=0,mn=1;function et(n){it(n)}function En(n,t){Nn(t,n._points.length,tt,n)}function it(n){const t=n._points,e=t.length,i=mn;for(var h=0;h<e;h++){const a=t[h];Nn(a,e,i,n)}}function Nn(n,t,e,i){const h=i._clonedPoints,a=i._edges,p=i._polygons,f=i.graph,v=n.prevPoint,k=n.nextPoint;rt(n,h);const l=new $n,s=new A([1/0,n.y],-1);for(let w=0;w<t;w++){const d=a[w];if(!d.containsPoint(n)&&Q(n,s,d)){if(B(n,d.p1,s)||B(n,d.p2,s))continue;l.addKey(new rn(n,s,d))}}l.keys.length>100&&console.log(l.keys.length);const u=[];let g=null,m=null;for(let w=0;w<t;w++){const d=h[w];if(d.isPointEqual(n))continue;if(e===mn&&n.angleToPoint(d)>Math.PI)break;if(l.keys.length>0)for(let I=0;I<d.edges.length;I++){const O=d.edges[I];if(K(n,d,O.getOtherPointInEdge(d))===-1){const C=new rn(n,d,O),M=l.findKeyPosition(C)-1;M!==-1&&l.keys[M].matchesOtherKey(C)&&l.keys.splice(M,1)}}l.keys.length>100&&console.log(l.keys.length);let E=!1;if(g===null||K(n,g,d)!==0||!B(n,g,d))l.keys.length===0?E=!0:Q(n,d,l.keys[0].edge)||(E=!0);else if(!m)E=!1;else{E=!0;for(let I=0;I<l.keys.length;I++){const O=l.keys[I];if(!O.edge.containsPoint(g)&&Q(g,d,O.edge)){E=!1;break}}E&&In(g,d,p)&&(E=!1)}const _=d.isPointEqual(v)||d.isPointEqual(k);E&&!_&&(E=!In(n,d,p)),E&&u.push(d);for(let I=0;I<d.edges.length;I++){const O=d.edges[I];if(!O.containsPoint(n)&&K(n,d,O.getOtherPointInEdge(d))===1){const C=new rn(n,d,O);l.addKey(C)}}g=d,m=E}const P=n.nodeId;f.addNode(P,{x:n.x,y:n.y});for(var x=0;x<u.length;x++){const w=u[x].nodeId;f.addNode(w,{x:u[x].x,y:u[x].y}),f.addLink(P,w)}}function rt(n,t){t.sort((e,i)=>{const h=n.angleToPoint(e),a=n.angleToPoint(i);if(h<a)return-1;if(h>a)return 1;const p=en(n,e),f=en(n,i);return p<f?-1:p>f?1:0})}function In(n,t,e){if(n.polygonID!==t.polygonID||n.polygonID===-1||t.polygonID===-1)return!1;const i=new A([(n.x+t.x)/2,(n.y+t.y)/2],-1);return ot(i,e[n.polygonID].edges)}function ot(n,t){const e=new A([1/0,n.y],-1);let i=0,h=!1,a=0;for(let p=0;p<t.length;p++){const f=t[p];if(n.y<f.p1.y&&n.y<f.p2.y||n.y>f.p1.y&&n.y>f.p2.y)continue;const v=K(n,f.p1,e)===0&&f.p1.x>n.x,k=K(n,f.p2,e)===0&&f.p2.x>n.x,l=v?f.p1:f.p2;v||k?(a=f.getOtherPointInEdge(l).y>n.y?a++:a--,h?(a===0&&i++,h=!1,a=0):h=!0):Q(n,e,f)&&i++}return i%2!==0}class st{constructor(){this.edges=[],this.bbox=[1/0,1/0,-1/0,-1/0]}}class Y{constructor(t,e){this.p1=t,this.p2=e,t.edges.push(this),e.edges.push(this)}getOtherPointInEdge(t){return this.p1.isPointEqual(t)?this.p2:this.p1}areEdgesEqual(t){return!!(this.p1.isPointEqual(t.p1)&&this.p2.isPointEqual(t.p2)||this.p1.isPointEqual(t.p2)&&this.p2.isPointEqual(t.p1))}containsPoint(t){return this.p1.isPointEqual(t)||this.p2.isPointEqual(t)}}function at(n){const t=n._geojson.type==="Feature"?n._geojson.geometry:n._geojson;let e=t.coordinates;t.type==="Polygon"&&(e=[e]);for(let i=0;i<e.length;i++){const h=new st,a=h.edges,p=h.bbox;n._polygons.push(h);for(let f=0;f<e[i].length;f++){let v=new A(e[i][f][0],i),k=new A(e[i][f][1],i);on(v,p),on(k,p),v.nextPoint=k;let l=new A(e[i][f][2],i);H(v,k,l),n._points.push(v);let s=new Y(v,k);n._edges.push(s),a.push(s);const u=v;v=k,k=l;for(let P=2;P<e[i][f].length-2;P++){n._points.push(v),l=new A(e[i][f][P+1],i),on(l,p),H(v,k,l);const x=new Y(v,k);n._edges.push(x),a.push(x),v=k,k=l,s=x}H(v,k,u);const g=new Y(s.p2,k);n._edges.push(g),a.push(g);const m=new Y(k,u);H(k,u,u.nextPoint),n._edges.push(m),a.push(m),n._points.push(v),n._points.push(l)}}n._clonedPoints=ut(n._points)}function ut(n){return n.slice(0)}function on(n,t){t[0]=Math.min(t[0],n.x),t[1]=Math.min(t[1],n.y),t[2]=Math.max(t[2],n.x),t[3]=Math.max(t[3],n.y)}function H(n,t,e){t.prevPoint=n,t.nextPoint=e}class ft{constructor(t,e){this._geojson=t,this.graph=null,this._points=[],this._clonedPoints=[],this._edges=[],this._polygons=[],this._lastOrigin=null,this._lastDestination=null,at(this),e?this.graph=Un(e):(this.graph=Mn(),et(this))}getNodeIdByLatLon(t){for(var e=0;e<this._points.length;e++)if(this._points[e].x===t[0]&&this._points[e].y===t[1])return this._points[e].nodeId;return null}saveGraphToJson(){return jn(this.graph)}addStartAndEndPointsToGraph(t,e){return this._lastOrigin!==null&&(this.graph.removeNode(this._lastOrigin.nodeId),this.graph.removeNode(this._lastDestination.nodeId)),this._lastOrigin=new A(t.geometry.coordinates,-1),this._lastDestination=new A(e.geometry.coordinates,-1),En(this,this._lastOrigin),En(this,this._lastDestination),{startNode:this._lastOrigin,endNode:this._lastDestination}}}self.addEventListener("message",function(n){const t=new ft(n.data.data);self.postMessage(t.saveGraphToJson())},!1)})();
